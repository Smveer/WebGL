<!DOCTYPE html>
<html lang="EN">
	<head>
		<title>Project WEBGL</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link type="text/css" rel="stylesheet" href="../ressources/css/main.css">
	</head>
	<body>

		<script type="module">

            //IMPORT DES DÉPENDANCES
			import * as THREE from '../build/three.module.js';
            import {OrbitControls} from "./jsm/controls/OrbitControls.js";

            //DÉCLARATIONS DES OBJETS DE LA SCÈNE
            var camera, scene, renderer, controls, ambient, spotLight, lightHelper;  

            //DÉCLARATION DE LA BASE 
            var mesh_floor, ground, leftWall, rightWall, frontWall, backWall;

            //DÉCLARATION DES TOURELLES DE LA BASE
            var turretBackLeft, turretBackRight, turretFrontLeft, turretFrontRight;

            //DÉCLARATION DE L'ENTRÉE
            var frontGateBig, frontGateSmall, miniTurretFrontLeft, miniTurretFrontRight, miniTurretBackLeft, miniTurretBackRight;

            //DÉCLARATION DES MINI TOURELLES DE LA TOURELLE GAUCHE
            var miniTurretFrontLeft_frontLeft, miniTurretFrontRight_frontLeft, miniTurretBackLeft_frontLeft, miniTurretBackRight_frontLeft;

            //DÉCLARATION DES MINI TOURELLES DE LA TOURELLE DROITE
            var miniTurretFrontLeft_frontRight, miniTurretFrontRight_frontRight, miniTurretBackLeft_frontRight, miniTurretBackRight_frontRight;

            //DÉCLARATION DES BATÎMENTS
            var mainBuilding, mainBuildingFront, mainBuildingLittleFront, mainBuildingMiddle;

            //DÉCLARATION DES MINI TOURELLES DES BATÎMENTS
            var miniTurretMainBuilding_frontLeft, miniTurretMainBuilding_frontRight;

            //DÉCLARATION DES OBJETS DES MINARETS
            var minaret_Base, minaret_LowerCylinder, minaret_deco2Base, minaret_deco1Base, minaret_BaseLinkOcto, minaret_LowerBalconyBottom, minaret_LowerBalconyTop;
            var minaret_MiddleCylinder, minaret_MiddleBalconyTop, minaret_MiddleBalconyBottom, minaret_HigherBalconyTop, minaret_HigherBalconyBottom;
            var minaret_SpikeBottom, minaret_Spike, minaret_SpikeCircle1, minaret_SpikeCircle2, minaret_SpikeTop, minaret_Moon;
           
            //DÉCLARATION DES DÔMES
            var sphere, cylindre, octogone;

            //CRÉATION DE LA CAMÉRA SUPER DYNAMIQUE
            camera = new THREE.PerspectiveCamera( 70, window.innerWidth/window.innerHeight, 1, 1000000 );
            camera.position.set( 70000, 70000, 70000 );

			init(); //Pour créer la scène
			animate(); //Pour animer la scène (boucle qui tourne en permanence)
            
			function init() {

                //Création de l'espace 3D (scène) avec ses axes
                scene = new THREE.Scene();
                scene.background = new THREE.CubeTextureLoader()
                    .setPath( 'textures/cube/MilkyWay/' )
                    .load( [
                        'dark-s_px.jpg',
                        'dark-s_nx.jpg',
                        'dark-s_py.jpg',
                        'dark-s_ny.jpg',
                        'dark-s_pz.jpg',
                        'dark-s_nz.jpg'
                    ] ); //SKYBOX DU BACKGROUND

                ambient = new THREE.AmbientLight( 0xffffff, 0.1 );
				scene.add( ambient );

                spotLight = new THREE.SpotLight( 0xffffff, 2 );
				spotLight.position.set( 20000, 40000, 40000 );
				spotLight.angle = 1.05;
				spotLight.penumbra = 0.1;
				spotLight.decay = 1;
                spotLight.focus = 1;
				spotLight.distance = 70000;

				spotLight.castShadow = true;
				spotLight.shadow.mapSize.width = 512;
				spotLight.shadow.mapSize.height = 512;
				spotLight.shadow.camera.near = 1;
				spotLight.shadow.camera.far = 100000;
				spotLight.shadow.focus = 1;
				scene.add( spotLight );

				lightHelper = new THREE.SpotLightHelper( spotLight );
				scene.add( lightHelper );

                //Chargement des textures
				var texture = new THREE.TextureLoader().load( '../ressources/textures/grid.png' );

                var turretTexture = new THREE.TextureLoader().load( '../ressources/textures/square-outline.png' );
                
                var wallTexture = new THREE.TextureLoader().load( '../ressources/textures/square-outline.png' );

                var groundTexture = new THREE.TextureLoader().load( '../ressources/textures/brick_bump.jpg' );
                    groundTexture.wrapS = THREE.RepeatWrapping;
                    groundTexture.wrapT = THREE.RepeatWrapping;
                    groundTexture.repeat.set( 20, 20 );

                var sphereTexture = new THREE.TextureLoader().load( '../ressources/textures/square-outline.png' );
                    sphereTexture.wrapS = THREE.RepeatWrapping;
                    sphereTexture.wrapT = THREE.RepeatWrapping;
                    sphereTexture.repeat.set( 30, 30 );

                //var grassTexture = new THREE.TextureLoader().load( '../ressources/textures/terrain/grasslight-big.jpg');
                                                     
                //Création des matériaux
                var material = new THREE.MeshPhongMaterial( { map: texture, side: THREE.DoubleSide } );
                var turretMaterial = new THREE.MeshPhongMaterial( { map: turretTexture, side: THREE.DoubleSide } );
                var wallMaterial = new THREE.MeshPhongMaterial( { map: wallTexture, side: THREE.DoubleSide } );
                var groundMaterial = new THREE.MeshPhongMaterial( { map: groundTexture, side: THREE.DoubleSide } );
                var sphereMaterial = new THREE.MeshPhongMaterial( { map: sphereTexture, side: THREE.DoubleSide } );
                //var grass = new THREE.MeshBasicMaterial( { map:  grassTexture, side: THREE.DoubleSide} );

                //PLATEAU
                //var floor = new THREE.BoxBufferGeometry(90000, 2000, 90000);
                //mesh_floor = new THREE.Mesh( floor,  grass);
                //mesh_floor.receiveShadow = true;
                //mesh_floor.position.y = -mesh_floor.geometry.parameters.height/2 - 1000;
                //scene.add(mesh_floor);
                                                
                //DÉFINITION DU SOL
				var groundGeometry = new THREE.BoxBufferGeometry( 30000, 1000, 42000 ); //Type/Forme d'objet
				ground = new THREE.Mesh( groundGeometry, groundMaterial ); //Création de l'objet avec ses matériaux
                ground.position.y = -ground.geometry.parameters.height/2;
                ground.receiveShadow = true;
				scene.add( ground ); //Ajout de l'objet dans la scene


                //DÉFINITION DES MURS
                var longWallGeometry = new THREE.BoxBufferGeometry( 3000, 3000, 42000 );
                var largeWallGeometry = new THREE.BoxBufferGeometry( 30000, 3000, 3000 );

                    leftWall = new THREE.Mesh( longWallGeometry, wallMaterial );
                    leftWall.receiveShadow = true;
                    leftWall.castShadow = true;
                    scene.add( leftWall );
                    leftWall.position.x = -13500;
                    leftWall.position.y = leftWall.geometry.parameters.height/2;;

                    rightWall = new THREE.Mesh( longWallGeometry, wallMaterial );
                    rightWall.receiveShadow = true;
                    rightWall.castShadow = true;
                    scene.add( rightWall );
                    rightWall.position.x = 13500;
                    rightWall.position.y = rightWall.geometry.parameters.height/2;

                    frontWall = new THREE.Mesh( largeWallGeometry, wallMaterial );
                    frontWall.receiveShadow = true;
                    frontWall.castShadow = true;
                    scene.add( frontWall );
                    frontWall.position.x = 0;
                    frontWall.position.y = frontWall.geometry.parameters.height/2;
                    frontWall.position.z = ground.geometry.parameters.depth/2 - 1250;   

                    backWall = new THREE.Mesh( largeWallGeometry, wallMaterial );
                    backWall.receiveShadow = true;
                    backWall.castShadow = true;
                    scene.add( backWall );
                    backWall.position.x = 0;
                    backWall.position.y = backWall.geometry.parameters.height/2;
                    backWall.position.z = -ground.geometry.parameters.depth/2 + 1250;  


				//DÉFINITION DES TOURELLES DE LA BASE ARRIÈRE
                var turretGeometry = new THREE.BoxBufferGeometry( 3500, 4000, 3500 );
                    // TOURELLE GAUCHE
                    turretBackLeft = new THREE.Mesh( turretGeometry, turretMaterial );
                    turretBackLeft.receiveShadow = true;
                    turretBackLeft.castShadow = true;
                    scene.add( turretBackLeft );
                    turretBackLeft.position.x = -ground.geometry.parameters.width/2 + 1166.667;
                    turretBackLeft.position.z = -ground.geometry.parameters.depth/2 + 5000;    
                    turretBackLeft.position.y = turretBackLeft.geometry.parameters.height/2;

                    // TOURELLE DROITE
                    turretBackRight = new THREE.Mesh( turretGeometry, turretMaterial );
                    turretBackRight.receiveShadow = true;
                    turretBackRight.castShadow = true;
                    scene.add( turretBackRight );
                    turretBackRight.position.x = ground.geometry.parameters.width/2 - 1166.667;
                    turretBackRight.position.z = -ground.geometry.parameters.depth/2 + 5000;    
                    turretBackRight.position.y = turretBackRight.geometry.parameters.height/2;


                //DÉFINITION DES TOURELLES DE LA BASE AVANT
                var turretFrontGeometry = new THREE.BoxBufferGeometry( 5000, 5000, 5000 );
                var miniGeometryTurret = new THREE.BoxBufferGeometry( 1000, 6000, 1000 );
                    // TOURELLE DROITE
                    turretFrontRight = new THREE.Mesh( turretFrontGeometry, turretMaterial );
                    turretFrontRight.receiveShadow = true;
                    turretFrontRight.castShadow = true;
                    scene.add( turretFrontRight );
                    turretFrontRight.position.x = rightWall.position.x - 250;
                    turretFrontRight.position.z = frontWall.position.z;    
                    turretFrontRight.position.y = turretFrontRight.geometry.parameters.height/2;

                    miniTurretFrontLeft_frontRight = new THREE.Mesh( miniGeometryTurret, turretMaterial );
                    miniTurretFrontLeft_frontRight.receiveShadow = true;
                    miniTurretFrontLeft_frontRight.castShadow = true;
                    scene.add ( miniTurretFrontLeft_frontRight );
                    miniTurretFrontLeft_frontRight.position.y = miniTurretFrontLeft_frontRight.geometry.parameters.height/2;
                    miniTurretFrontLeft_frontRight.position.x = turretFrontRight.position.x - (turretFrontRight.geometry.parameters.width/2);
                    miniTurretFrontLeft_frontRight.position.z = turretFrontRight.position.z + (turretFrontRight.geometry.parameters.depth/2);

                    miniTurretFrontRight_frontRight = new THREE.Mesh( miniGeometryTurret, turretMaterial );
                    miniTurretFrontRight_frontRight.receiveShadow = true;
                    miniTurretFrontRight_frontRight.castShadow = true;
                    scene.add ( miniTurretFrontRight_frontRight );
                    miniTurretFrontRight_frontRight.position.y = miniTurretFrontRight_frontRight.geometry.parameters.height/2;
                    miniTurretFrontRight_frontRight.position.x = turretFrontRight.position.x + (turretFrontRight.geometry.parameters.width/2);
                    miniTurretFrontRight_frontRight.position.z = turretFrontRight.position.z + (turretFrontRight.geometry.parameters.depth/2); 

                    miniTurretBackRight_frontRight = new THREE.Mesh( miniGeometryTurret, turretMaterial );
                    miniTurretBackRight_frontRight.receiveShadow = true;
                    miniTurretBackRight_frontRight.castShadow = true;
                    scene.add ( miniTurretBackRight_frontRight );
                    miniTurretBackRight_frontRight.position.y = miniTurretBackRight_frontRight.geometry.parameters.height/2;
                    miniTurretBackRight_frontRight.position.x = turretFrontRight.position.x + (turretFrontRight.geometry.parameters.width/2);
                    miniTurretBackRight_frontRight.position.z = turretFrontRight.position.z - (turretFrontRight.geometry.parameters.depth/2);

                    // TOURELLE GAUCHE
                    turretFrontLeft = new THREE.Mesh( turretFrontGeometry, turretMaterial );
                    turretFrontLeft.receiveShadow = true;
                    turretFrontLeft.castShadow = true;
                    scene.add( turretFrontLeft );
                    turretFrontLeft.position.x = leftWall.position.x - 250;
                    turretFrontLeft.position.z = frontWall.position.z;    
                    turretFrontLeft.position.y = turretFrontLeft.geometry.parameters.height/2;

                    miniTurretFrontLeft_frontLeft = new THREE.Mesh( miniGeometryTurret, turretMaterial );
                    miniTurretFrontLeft_frontLeft.receiveShadow = true;
                    miniTurretFrontLeft_frontLeft.castShadow = true;
                    scene.add ( miniTurretFrontLeft_frontLeft );
                    miniTurretFrontLeft_frontLeft.position.y = miniTurretFrontLeft_frontLeft.geometry.parameters.height/2;
                    miniTurretFrontLeft_frontLeft.position.x = turretFrontLeft.position.x - (turretFrontLeft.geometry.parameters.width/2);
                    miniTurretFrontLeft_frontLeft.position.z = turretFrontLeft.position.z + (turretFrontLeft.geometry.parameters.depth/2);

                    miniTurretFrontRight_frontLeft = new THREE.Mesh( miniGeometryTurret, turretMaterial );
                    miniTurretFrontRight_frontLeft.receiveShadow = true;
                    miniTurretFrontRight_frontLeft.castShadow = true;
                    scene.add ( miniTurretFrontRight_frontLeft );
                    miniTurretFrontRight_frontLeft.position.y = miniTurretFrontRight_frontLeft.geometry.parameters.height/2;
                    miniTurretFrontRight_frontLeft.position.x = turretFrontLeft.position.x + (turretFrontLeft.geometry.parameters.width/2);
                    miniTurretFrontRight_frontLeft.position.z = turretFrontLeft.position.z + (turretFrontLeft.geometry.parameters.depth/2); 

                    miniTurretBackLeft_frontLeft = new THREE.Mesh( miniGeometryTurret, turretMaterial );
                    miniTurretBackLeft_frontLeft.receiveShadow = true;
                    miniTurretBackLeft_frontLeft.castShadow = true;
                    scene.add ( miniTurretBackLeft_frontLeft );
                    miniTurretBackLeft_frontLeft.position.y = miniTurretBackLeft_frontLeft.geometry.parameters.height/2;
                    miniTurretBackLeft_frontLeft.position.x = turretFrontLeft.position.x - (turretFrontLeft.geometry.parameters.width/2);
                    miniTurretBackLeft_frontLeft.position.z = turretFrontLeft.position.z - (turretFrontLeft.geometry.parameters.depth/2);
                     
                
                //DÉFINITION DES BÂTIMENTS
                var mainBuildGeometry = new THREE.BoxBufferGeometry( 27000, 6000, 7000 );       
                var mainBuildFrGeo = new THREE.BoxBufferGeometry( 27000, 3500, 3500 );
                var mainBuildLitFrGeo = new THREE.BoxBufferGeometry( 27000, 2000, 1750 );        
                var mainBuildMidGeo = new THREE.BoxBufferGeometry( 10000, 4500, 6250);


                    mainBuilding = new THREE.Mesh( mainBuildGeometry, turretMaterial );
                    mainBuilding.receiveShadow = true;
                    mainBuilding.castShadow = true;
                    scene.add( mainBuilding );
                    
                    mainBuilding.position.y = mainBuilding.geometry.parameters.height/2;
                    mainBuilding.receiveShadow = true;
                    mainBuilding.castShadow = true;
                    mainBuilding.position.z = -16000;

                    mainBuildingFront = new THREE.Mesh( mainBuildFrGeo, turretMaterial );
                    mainBuildingFront.receiveShadow = true;
                    mainBuildingFront.castShadow = true;
                    scene.add( mainBuildingFront );
                    mainBuildingFront.position.y = mainBuildingFront.geometry.parameters.height/2;
                    mainBuildingFront.position.z = mainBuilding.position.z + (mainBuilding.geometry.parameters.depth/2) + (mainBuildingFront.geometry.parameters.depth/2);

                    mainBuildingLittleFront = new THREE.Mesh( mainBuildLitFrGeo, wallMaterial );
                    mainBuildingLittleFront.receiveShadow = true;
                    mainBuildingLittleFront.castShadow = true;
                    scene.add( mainBuildingLittleFront );
                    mainBuildingLittleFront.position.y = mainBuildingLittleFront.geometry.parameters.height/2;
                    mainBuildingLittleFront.position.z = mainBuildingFront.position.z + (mainBuildingFront.geometry.parameters.depth/2) + (mainBuildingLittleFront.geometry.parameters.depth/2);
                    
                    mainBuildingMiddle = new THREE.Mesh( mainBuildMidGeo, turretMaterial );
                    mainBuildingMiddle.receiveShadow = true;
                    mainBuildingMiddle.castShadow = true;
                    scene.add( mainBuildingMiddle );
                    mainBuildingMiddle.position.y = mainBuildingMiddle.geometry.parameters.height/2;
                    mainBuildingMiddle.position.z = mainBuildingFront.position.z + (mainBuildingLittleFront.geometry.parameters.depth/2) + 500;

                    miniTurretMainBuilding_frontLeft = new THREE.Mesh( miniGeometryTurret, turretMaterial );
                    miniTurretMainBuilding_frontLeft.receiveShadow = true;
                    miniTurretMainBuilding_frontLeft.castShadow = true;
                    scene.add( miniTurretMainBuilding_frontLeft );
                    miniTurretMainBuilding_frontLeft.position.y = (miniTurretMainBuilding_frontLeft.geometry.parameters.height/2);
                    miniTurretMainBuilding_frontLeft.position.x = mainBuildingMiddle.position.x - (mainBuildingMiddle.geometry.parameters.width/2);
                    miniTurretMainBuilding_frontLeft.position.z = mainBuildingMiddle.position.z + (mainBuildingMiddle.geometry.parameters.depth/2);

                    miniTurretMainBuilding_frontRight = new THREE.Mesh( miniGeometryTurret, turretMaterial );
                    miniTurretMainBuilding_frontRight.receiveShadow = true;
                    miniTurretMainBuilding_frontRight.castShadow = true;
                    scene.add( miniTurretMainBuilding_frontRight );
                    miniTurretMainBuilding_frontRight.position.y = (miniTurretMainBuilding_frontRight.geometry.parameters.height/2);
                    miniTurretMainBuilding_frontRight.position.x = mainBuildingMiddle.position.x + (mainBuildingMiddle.geometry.parameters.width/2);
                    miniTurretMainBuilding_frontRight.position.z = mainBuildingMiddle.position.z + (mainBuildingMiddle.geometry.parameters.depth/2);

                    //DÉFINITION DE L'ENTRÉ
                    var gateGeometry = new THREE.BoxBufferGeometry( 10000, 4000, 5000 );
                    var miniGeometry = new THREE.BoxBufferGeometry( 1000, 5000, 1000 );

                    frontGateBig = new THREE.Mesh( turretFrontGeometry, turretMaterial );
                    scene.add( frontGateBig );
                    frontGateBig.position.z = frontWall.position.z + 500;    
                    frontGateBig.position.y = frontGateBig.geometry.parameters.height/2;

                    frontGateSmall = new THREE.Mesh ( gateGeometry, turretMaterial );
                    scene.add( frontGateSmall );
                    frontGateSmall.position.y = frontGateSmall.geometry.parameters.height/2;
                    frontGateSmall.position.z = frontGateBig.position.z - 500;

                    miniTurretFrontLeft = new THREE.Mesh ( miniGeometry, turretMaterial );
                    scene.add ( miniTurretFrontLeft );
                    miniTurretFrontLeft.position.y = miniTurretFrontLeft.geometry.parameters.height/2;
                    miniTurretFrontLeft.position.z = frontGateSmall.position.z + (frontGateSmall.geometry.parameters.depth/2);
                    miniTurretFrontLeft.position.x = frontGateSmall.position.x - (frontGateSmall.geometry.parameters.width/2);

                    miniTurretFrontRight = new THREE.Mesh ( miniGeometry, turretMaterial );
                    scene.add ( miniTurretFrontRight );
                    miniTurretFrontRight.position.y = miniTurretFrontRight.geometry.parameters.height/2;
                    miniTurretFrontRight.position.z = frontGateSmall.position.z + (frontGateSmall.geometry.parameters.depth/2);
                    miniTurretFrontRight.position.x = frontGateSmall.position.x + (frontGateSmall.geometry.parameters.width/2);

                    miniTurretBackLeft = new THREE.Mesh ( miniGeometry, turretMaterial );
                    scene.add ( miniTurretBackLeft );
                    miniTurretBackLeft.position.y = miniTurretBackLeft.geometry.parameters.height/2;
                    miniTurretBackLeft.position.z = frontGateSmall.position.z - (frontGateSmall.geometry.parameters.depth/2);
                    miniTurretBackLeft.position.x = frontGateSmall.position.x - (frontGateSmall.geometry.parameters.width/2);

                    miniTurretBackRight = new THREE.Mesh ( miniGeometry, turretMaterial );
                    scene.add ( miniTurretBackRight );
                    miniTurretBackRight.position.y = miniTurretBackRight.geometry.parameters.height/2;
                    miniTurretBackRight.position.z = frontGateSmall.position.z - (frontGateSmall.geometry.parameters.depth/2);
                    miniTurretBackRight.position.x = frontGateSmall.position.x + (frontGateSmall.geometry.parameters.width/2);

                addMinaret(turretFrontLeft);
                addMinaret(turretBackLeft, mainBuildingLittleFront);
                addMinaret(turretFrontRight);
                addMinaret(turretBackRight, mainBuildingLittleFront);
                
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ DEBUT DOMES @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

                // DEFINITION PETITS DOMES
                function addDome(build, size, gapx, gapz){
                    var dome_sphere = new THREE.SphereBufferGeometry( size, 32, 32);
                    var dome_cylindre = new THREE.CylinderGeometry( size, size, size, 32 );
                    var dome_octogone = new THREE.CylinderGeometry( size+100, size+200, 500, 32 );

                        octogone = new THREE.Mesh( dome_octogone,material);
                        octogone.position.y = build.position.y + (build.geometry.parameters.height/2) + (octogone.geometry.parameters.height/2);
                        octogone.position.x = build.position.x + gapx;
                        octogone.position.z = build.position.z + gapz;
                        octogone.castShadow = true;
                        octogone.receiveShadow = true;
                        scene.add(octogone);

                        cylindre = new THREE.Mesh( dome_cylindre,material);
                        cylindre.position.y = octogone.position.y + cylindre.geometry.parameters.height/2;
                        cylindre.position.x = octogone.position.x;
                        cylindre.position.z = octogone.position.z;
                        cylindre.castShadow = true;
                        cylindre.receiveShadow = true;
                        scene.add(cylindre);

                        sphere = new THREE.Mesh( dome_sphere, sphereMaterial);
                        sphere.position.y = cylindre.position.y + sphere.geometry.parameters.radius;
                        sphere.position.x = cylindre.position.x;
                        sphere.position.z = cylindre.position.z;
                        sphere.castShadow = true;
                        sphere.receiveShadow = true;
                        scene.add(sphere);
                }

                //for(var i = 0, i <=) faire boucle sur chaque 
                addDome(frontWall, 700, -6500, 0);
                addDome(frontWall, 700, -9500, 0);
                addDome(frontWall, 700, 6500, 0);
                addDome(frontWall, 700, 9500, 0);
                addDome(mainBuildingLittleFront, 700, -6500, 0);
                addDome(mainBuildingLittleFront, 700, -9500, 0);
                addDome(mainBuildingLittleFront, 700, 6500, 0);
                addDome(mainBuildingLittleFront, 700, 9500, 0);
                addDome(rightWall, 700, 0, -5000);
                addDome(rightWall, 700, 0, 5000);
                addDome(leftWall, 700, 0, -5000);
                addDome(leftWall, 700, 0, 5000);

                addDome(mainBuilding, 3250, 0, 0);
                addDome(mainBuilding, 2000, -7000, 0);
                addDome(mainBuilding, 2000, 7000, 0);
                
                addDome(mainBuildingMiddle, 1200, 0, 0);
                addDome(frontGateBig, 1000, 0, 0);

//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ FIN DOMES @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

                renderer = new THREE.WebGLRenderer( { antialias: true } ); //Moteur graphique (anti-aliasing: pour lisser le graphisme)
				renderer.setPixelRatio( window.devicePixelRatio ); //Respect du ration des pixels
				renderer.setSize( window.innerWidth, window.innerHeight ); //Taille du rendu
				document.body.appendChild( renderer.domElement ); //Attachement du rendu à l'html

                renderer.shadowMap.enabled = true; //Autoriser les ombres dans le moteur
                renderer.shadowMap.type = THREE.PCFSoftShadowMap; //Type d'ombre soft
                
                controls = new OrbitControls( camera, renderer.domElement );
                controls.update();

				window.addEventListener( 'resize', onWindowResize, false ); //Adaptation au changement de taille de la fenêtre avec appel de sa fonction ↩️

                //FONCTION MINARETS
                function addMinaret(turret, mainBuild){
                    var baseMinaretGeo = new THREE.BoxBufferGeometry( 200*(6000/700), 12000, 200*(6000/700) );
                    var decoMinaretGeo = new THREE.ConeBufferGeometry( 150*(6000/700), 200*(6000/700), 4 );
                    var linkGeo = new THREE.CylinderGeometry( 100*(6000/700), 140*(6000/700), 100*(6000/700), 4, 1 );
                    var geoLC = new THREE.CylinderBufferGeometry( 100*(6000/700), 100*(6000/700), 400*(6000/700), 8 );
                    var balconyGeoLB = new THREE.CylinderGeometry( 180*(6000/700), 100*(6000/700),50*(6000/700), 600, 1 );
                    var balconyGeoLT = new THREE.CylinderBufferGeometry( 180*(6000/700), 180*(6000/700), 30*(6000/700), 1000 );
                    var geoMC = new THREE.CylinderBufferGeometry( 50*(6000/700), 100*(6000/700), 400*(6000/700), 1000 );
                    var balconyGeoMB = new THREE.CylinderGeometry( 120*(6000/700), 80*(6000/700),50*(6000/700), 600, 1 );
                    var balconyGeoMT = new THREE.CylinderBufferGeometry( 120*(6000/700), 120*(6000/700), 30*(6000/700), 1000 );
                    var balconyGeoHB = new THREE.CylinderGeometry( 80*(6000/700), 50*(6000/700), 50*(6000/700), 600, 1 );
                    var balconyGeoHT = new THREE.CylinderBufferGeometry( 80*(6000/700), 80*(6000/700), 30*(6000/700), 1000 );
                    var spikeBottomGeo = new THREE.SphereBufferGeometry( 50*(6000/700), 32, 32 );
                    var spikeGeo = new THREE.CylinderBufferGeometry( 10*(6000/700), 30*(6000/700), 300*(6000/700), 1000 );
                    var spikeCircleGeo = new THREE.CylinderBufferGeometry( 30*(6000/700), 30*(6000/700), 10*(6000/700), 1000 );
                    var spikeTopGeo = new THREE.SphereBufferGeometry( 30*(6000/700), 30*(6000/700), 10 );
                    var moonGeo = new THREE.RingGeometry( 20*(6000/700), 30*(6000/700), 3000 );

                    //  BASE
                    minaret_Base = new THREE.Mesh( baseMinaretGeo, material ) ;//Création de l'objet avec ses matériaux
                    minaret_Base.position.y = minaret_Base.geometry.parameters.height/2;
                    
                    
                    if (turret.position.x > 0){
                        minaret_Base.position.x = turret.position.x - (turret.geometry.parameters.width/2);
                    } else {
                        minaret_Base.position.x = turret.position.x + (turret.geometry.parameters.width/2);
                    }

                    if(mainBuild != null){
                        console.log('wesh');
                        minaret_Base.position.z = mainBuild.position.z + minaret_Base.geometry.parameters.depth;
                    } else {
                        if (turret.position.z > 0){
                            minaret_Base.position.z = turret.position.z - (turret.geometry.parameters.depth/2);
                        } else {
                            minaret_Base.position.z = turret.position.z + (turret.geometry.parameters.depth/2);
                        }
                    }
                    
                    minaret_Base.castShadow = true;
                    scene.add(minaret_Base ); //Ajout de l'objet dans la scene

                    minaret_deco1Base = new THREE.Mesh( decoMinaretGeo, material );
                    minaret_deco1Base.position.y = minaret_Base.position.y + minaret_deco1Base.geometry.parameters.height/2;
                    minaret_deco1Base.position.z = minaret_Base.position.z;
                    minaret_deco1Base.position.x = minaret_Base.position.x;
                    
                    minaret_deco1Base.castShadow = true;
                    scene.add(minaret_deco1Base );
                    
                    minaret_deco2Base = new THREE.Mesh( decoMinaretGeo, material );
                    minaret_deco2Base.position.y = minaret_Base.position.y + minaret_deco2Base.geometry.parameters.height*2;
                    minaret_deco2Base.position.z = minaret_Base.position.z;
                    minaret_deco2Base.position.x = minaret_Base.position.x;
                    
                    minaret_deco2Base.castShadow = true;
                    scene.add(minaret_deco2Base );

                    minaret_BaseLinkOcto = new THREE.Mesh(linkGeo, material);
                    minaret_BaseLinkOcto.position.y = minaret_Base.position.y + minaret_Base.geometry.parameters.height/2 + minaret_BaseLinkOcto.geometry.parameters.height/2;;
                    minaret_BaseLinkOcto.rotation.y = Math.PI / 4;
                    minaret_BaseLinkOcto.position.z = minaret_Base.position.z;
                    minaret_BaseLinkOcto.position.x = minaret_Base.position.x;
                    
                    minaret_BaseLinkOcto.castShadow = true;
                    scene.add(minaret_BaseLinkOcto);
                
                    //  TRONC DU BAS
                    minaret_LowerCylinder = new THREE.Mesh( geoLC, material );
                    minaret_LowerCylinder.position.y = minaret_BaseLinkOcto.position.y + minaret_BaseLinkOcto.geometry.parameters.height/2 + minaret_LowerCylinder.geometry.parameters.height/2;
                    minaret_LowerCylinder.position.z = minaret_Base.position.z;
                    minaret_LowerCylinder.position.x = minaret_Base.position.x;                
                    
                    minaret_LowerCylinder.castShadow = true;
                    scene.add(minaret_LowerCylinder );

                    minaret_LowerBalconyBottom = new THREE.Mesh(balconyGeoLB, material);
                    minaret_LowerBalconyBottom.position.y = minaret_LowerCylinder.position.y + minaret_LowerCylinder.geometry.parameters.height/2 + minaret_LowerBalconyBottom.geometry.parameters.height/2;
                    minaret_LowerBalconyBottom.rotation.y = Math.PI / 4;
                    minaret_LowerBalconyBottom.position.z = minaret_Base.position.z;
                    minaret_LowerBalconyBottom.position.x = minaret_Base.position.x;
                    
                    minaret_LowerBalconyBottom.castShadow = true;
                    scene.add(minaret_LowerBalconyBottom);

                    minaret_LowerBalconyTop = new THREE.Mesh( balconyGeoLT, material );
                    minaret_LowerBalconyTop.position.y = minaret_LowerBalconyBottom.position.y + minaret_LowerBalconyBottom.geometry.parameters.height/2 + minaret_LowerBalconyTop.geometry.parameters.height/2;
                    minaret_LowerBalconyTop.position.z = minaret_Base.position.z;
                    minaret_LowerBalconyTop.position.x = minaret_Base.position.x;
                    
                    minaret_LowerBalconyTop.castShadow = true;
                    scene.add(minaret_LowerBalconyTop );
                    
                    //  TRONC DU HAUT
                    minaret_MiddleCylinder = new THREE.Mesh( geoMC, material );
                    minaret_MiddleCylinder.position.y = minaret_LowerBalconyTop.position.y + minaret_LowerBalconyTop.geometry.parameters.height/2 + minaret_MiddleCylinder.geometry.parameters.height/2;
                    minaret_MiddleCylinder.position.z = minaret_Base.position.z;
                    minaret_MiddleCylinder.position.x = minaret_Base.position.x;
                    
                    minaret_MiddleCylinder.castShadow = true;
                    scene.add(minaret_MiddleCylinder );

                    minaret_MiddleBalconyBottom = new THREE.Mesh(balconyGeoMB, material);
                    minaret_MiddleBalconyBottom.position.y = minaret_MiddleCylinder.position.y + minaret_MiddleCylinder.geometry.parameters.height/2 + minaret_MiddleBalconyBottom.geometry.parameters.height/2;
                    minaret_MiddleBalconyBottom.rotation.y = Math.PI / 4;
                    minaret_MiddleBalconyBottom.position.z = minaret_Base.position.z;
                    minaret_MiddleBalconyBottom.position.x = minaret_Base.position.x;
                    
                    minaret_MiddleBalconyBottom.castShadow = true;
                    scene.add(minaret_MiddleBalconyBottom);

                    minaret_MiddleBalconyTop = new THREE.Mesh( balconyGeoMT, material );
                    minaret_MiddleBalconyTop.position.y = minaret_MiddleBalconyBottom.position.y + minaret_MiddleBalconyBottom.geometry.parameters.height/2 + minaret_MiddleBalconyTop.geometry.parameters.height/2;
                    minaret_MiddleBalconyTop.position.z = minaret_Base.position.z;
                    minaret_MiddleBalconyTop.position.x = minaret_Base.position.x;
                    
                    minaret_MiddleBalconyTop.castShadow = true;
                    scene.add(minaret_MiddleBalconyTop );

                    minaret_HigherBalconyBottom = new THREE.Mesh(balconyGeoHB, material);
                    minaret_HigherBalconyBottom.position.y = minaret_MiddleBalconyTop.position.y + minaret_MiddleBalconyTop.geometry.parameters.height/2 + minaret_HigherBalconyBottom.geometry.parameters.height/2;
                    minaret_HigherBalconyBottom.rotation.y = Math.PI / 4;
                    minaret_HigherBalconyBottom.position.z = minaret_Base.position.z;
                    minaret_HigherBalconyBottom.position.x = minaret_Base.position.x;
                    
                    minaret_HigherBalconyBottom.castShadow = true;
                    scene.add(minaret_HigherBalconyBottom);

                    minaret_HigherBalconyTop = new THREE.Mesh( balconyGeoHT, material );
                    minaret_HigherBalconyTop.position.y = minaret_HigherBalconyBottom.position.y + minaret_HigherBalconyBottom.geometry.parameters.height/2 + minaret_HigherBalconyTop.geometry.parameters.height/2;
                    minaret_HigherBalconyTop.position.z = minaret_Base.position.z;
                    minaret_HigherBalconyTop.position.x = minaret_Base.position.x;
                    
                    minaret_HigherBalconyTop.castShadow = true;
                    scene.add(minaret_HigherBalconyTop );

                    //  POINTE DU MINARET
                    minaret_SpikeBottom = new THREE.Mesh( spikeBottomGeo, material );
                    minaret_SpikeBottom.position.y = minaret_HigherBalconyTop.position.y + minaret_HigherBalconyTop.geometry.parameters.height/2 + minaret_SpikeBottom.geometry.parameters.radius;
                    minaret_SpikeBottom.position.z = minaret_Base.position.z;
                    minaret_SpikeBottom.position.x = minaret_Base.position.x;
                    
                    minaret_SpikeBottom.castShadow = true;
                    scene.add(minaret_SpikeBottom );

                    minaret_Spike = new THREE.Mesh( spikeGeo, material );
                    minaret_Spike.position.y = minaret_SpikeBottom.position.y + minaret_SpikeBottom.geometry.parameters.radius + minaret_Spike.geometry.parameters.height/2;
                    minaret_Spike.position.z = minaret_Base.position.z;
                    minaret_Spike.position.x = minaret_Base.position.x;
                    
                    minaret_Spike.castShadow = true;
                    scene.add(minaret_Spike);

                    minaret_SpikeCircle1 = new THREE.Mesh( spikeCircleGeo, material );
                    minaret_SpikeCircle1.position.y = minaret_Spike.position.y + minaret_Spike.geometry.parameters.height/2 + minaret_SpikeCircle1.geometry.parameters.height/2;
                    minaret_SpikeCircle1.position.z = minaret_Base.position.z;
                    minaret_SpikeCircle1.position.x = minaret_Base.position.x;
                    
                    minaret_SpikeCircle1.castShadow = true;
                    scene.add(minaret_SpikeCircle1 );

                    minaret_SpikeCircle2 = new THREE.Mesh( spikeCircleGeo, material );
                    minaret_SpikeCircle2.position.y = minaret_SpikeCircle1.position.y + minaret_SpikeCircle1.geometry.parameters.height/2 + minaret_SpikeCircle2.geometry.parameters.height/2;
                    minaret_SpikeCircle2.position.z = minaret_Base.position.z;
                    minaret_SpikeCircle2.position.x = minaret_Base.position.x;
                    
                    minaret_SpikeCircle2.castShadow = true;
                    scene.add(minaret_SpikeCircle2 );

                    minaret_SpikeTop = new THREE.Mesh( spikeTopGeo, material );
                    minaret_SpikeTop.position.y = minaret_SpikeCircle2.position.y + minaret_SpikeCircle2.geometry.parameters.height/2 + minaret_SpikeTop.geometry.parameters.radius;
                    minaret_SpikeTop.position.z = minaret_Base.position.z;
                    minaret_SpikeTop.position.x = minaret_Base.position.x;
                    
                    minaret_SpikeTop.castShadow = true;
                    scene.add(minaret_SpikeTop );

                    minaret_Moon = new THREE.Mesh( moonGeo, material );
                    minaret_Moon.position.y = minaret_SpikeTop.position.y + minaret_SpikeTop.geometry.parameters.radius;
                    minaret_Moon.position.z = minaret_Base.position.z;
                    minaret_Moon.position.x = minaret_Base.position.x;
                    
                    minaret_Moon.castShadow = true;
                    scene.add(minaret_Moon );

                }

			}

			function onWindowResize() {
                //Adaptation au changement de taille de la fenêtre
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
                
				renderer.setSize( window.innerWidth, window.innerHeight ); //Taille du rendu

			}
            
            function animate() {

                requestAnimationFrame( animate );

                // required if controls.enableDamping or controls.autoRotate are set to true
                controls.update();
                
                
                renderer.render( scene, camera );

            }

            
		</script>
	</body>
</html>
